<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç£å…©æ£²é¡å…¨åœ–é‘‘ (å®Œæ•´ç‰ˆ)</title>
    <style>
        :root {
            --primary: #00695c;
            --secondary: #26a69a;
            --accent: #ffb74d;
            --bg: #e0f2f1;
            --text: #263238;
            --card-bg: #ffffff;
            --status-common: #558b2f;
            --status-endemic: #7b1fa2;
            --status-conservation: #c62828;
            --status-invasive: #424242;
            --status-salamander: #795548;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0; padding-bottom: 80px;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, #004d40, #00796b);
            color: white; padding: 1.2rem 1rem; text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: sticky; top: 0; z-index: 100;
        }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1.5px; }
        .subtitle { font-size: 0.8rem; opacity: 0.9; margin-top: 5px; }

        /* --- Navigation --- */
        .nav {
            display: flex; justify-content: flex-start; gap: 10px; 
            padding: 10px 15px; background: white; 
            border-bottom: 1px solid #b2dfdb;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky; top: 78px; z-index: 90;
            overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none;
        }
        .nav::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            padding: 8px 16px; border: none; border-radius: 50px;
            background: #eceff1; color: #546e7a; cursor: pointer;
            font-weight: bold; transition: all 0.2s; 
            font-size: 0.9rem; white-space: nowrap; flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 5px;
        }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0, 105, 92, 0.4); }

        .container { max-width: 1000px; margin: 0 auto; padding: 15px; min-height: 80vh; }
        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Daily Card --- */
        .daily-container { width: 100%; max-width: 480px; margin: 0 auto; text-align: center; }
        .card-scene { perspective: 1000px; width: 100%; height: min(580px, 65vh); margin: 20px auto; position: relative; }
        .card-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; -webkit-backface-visibility: hidden;
            border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow: hidden; background: white;
        }
        .card-front { background: linear-gradient(135deg, #26a69a, #4db6ac); color: white; border: 4px solid #e0f2f1; z-index: 2; cursor: pointer; }
        .card-back { transform: rotateY(180deg); padding: 0; justify-content: flex-start; border: 1px solid #ddd; background: #fdfdfd; z-index: 1; }
        
        .daily-img-wrapper { width: 100%; height: 55%; background: #212121; position: relative; display: flex; align-items: center; justify-content: center; cursor: zoom-in; }
        .daily-img { width: 100%; height: 100%; object-fit: contain; display: block; }
        .zoom-hint { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; padding: 6px 10px; border-radius: 20px; font-size: 0.75rem; pointer-events: none; }
        .daily-info-box { padding: 20px; text-align: left; height: 45%; overflow-y: auto; box-sizing: border-box; }
        .daily-date { background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 20px; margin-bottom: 20px; font-size: 0.9rem; letter-spacing: 1px; }

        /* --- Tools & Grid --- */
        .tools-bar { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #b2dfdb; }
        .search-box { width: 100%; padding: 10px; border: 2px solid #80cbc4; border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-bottom: 12px; }
        .filter-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .filter-tag { white-space: nowrap; padding: 6px 14px; border-radius: 15px; background: #e0f2f1; border: 1px solid #4db6ac; cursor: pointer; font-size: 0.85rem; color: #00695c; flex-shrink: 0; }
        .filter-tag.active { background: var(--primary); color: white; border-color: var(--primary); }

        .plant-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .plant-card {
            background: var(--card-bg); border-radius: 12px; padding: 15px 10px; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #f1f1f1;
            display: flex; flex-direction: column; justify-content: center; min-height: 110px; position: relative;
        }
        .plant-card:active { transform: scale(0.98); background: #f9f9f9; }
        .p-name { font-weight: bold; font-size: 1rem; color: #004d40; margin-bottom: 5px; }
        .p-cat { font-size: 0.75rem; color: #00796b; margin-bottom: 8px; }
        .status-badge { font-size: 0.7rem; color: white; padding: 3px 8px; border-radius: 10px; display: inline-block; font-weight: bold; margin-top: auto; }
        .st-endemic { background: var(--status-endemic); }
        .st-common { background: var(--status-common); }
        .st-conservation { background: var(--status-conservation); }
        .st-invasive { background: var(--status-invasive); }
        .st-salamander { background: var(--status-salamander); }
        .has-sound-icon { position: absolute; top: 5px; right: 5px; font-size: 0.8rem; opacity: 0.6; }

        /* --- Quiz Common --- */
        .quiz-panel { background: white; padding: 25px 20px; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; max-width: 600px; margin: 0 auto; border: 1px solid #eee; }
        .q-media-box { height: 280px; background: #fafafa; border: 2px dashed #80cbc4; border-radius: 12px; margin: 20px 0; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .full-img { max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        .opt-btn { width: 100%; padding: 14px; margin-bottom: 10px; background: white; border: 2px solid #b2dfdb; border-radius: 10px; font-size: 0.95rem; cursor: pointer; font-weight: bold; color: #00695c; touch-action: manipulation; }
        .opt-btn:active { background: #e0f2f1; }
        .opt-btn.correct { background: #b2dfdb; border-color: #26a69a; color: #004d40; }
        .opt-btn.wrong { background: #ffcdd2; border-color: #ef5350; color: #b71c1c; }
        
        /* --- Sound Quiz Specific --- */
        .sound-player-large {
            width: 100%; height: 100%; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; cursor: pointer;
            background: linear-gradient(to bottom, #f1f8e9, #dcedc8);
            transition: 0.2s;
        }
        .sound-player-large:active { background: #c5e1a5; }
        .sp-icon { font-size: 5rem; color: var(--primary); margin-bottom: 10px; }
        .sp-text { font-weight: bold; color: #558b2f; }
        .playing-wave {
            display: flex; gap: 5px; height: 30px; align-items: flex-end; margin-top: 10px; opacity: 0;
        }
        .playing-wave.active { opacity: 1; }
        .wave-bar { width: 6px; background: var(--secondary); animation: wave 1s infinite ease-in-out; border-radius: 3px; }
        .wave-bar:nth-child(1) { animation-delay: 0s; height: 15px; }
        .wave-bar:nth-child(2) { animation-delay: 0.1s; height: 25px; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; height: 10px; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; height: 20px; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; height: 12px; }
        @keyframes wave { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.5); } }

        /* --- Modal --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 15px; backdrop-filter: blur(5px); }
        .modal-box { background: white; width: 100%; max-width: 500px; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; max-height: 85vh; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3); animation: popUp 0.3s; }
        .img-area { height: 40vh; background: #000; display: flex; align-items: center; justify-content: center; position: relative; }
        .info-area { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; flex: 1; }
        .audio-btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; padding: 12px; margin-top: 10px; margin-bottom: 15px;
            background: #fff3e0; border: 1px solid #ffb74d; color: #ef6c00;
            border-radius: 8px; cursor: pointer; font-weight: bold;
        }
        .audio-btn.disabled { opacity: 0.5; cursor: not-allowed; background: #eee; border-color: #ddd; color: #999; }
        
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .reveal-box { background: #e0f2f1; border: 1px solid #b2dfdb; border-radius: 12px; padding: 15px; text-align: left; margin-top: 15px; display: none; }

        @media (min-width: 768px) {
            .container { padding: 30px; }
            .plant-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
            .nav { justify-content: center; top: 85px; }
            .card-scene { height: 550px; }
            h1 { font-size: 2rem; }
            .img-area { height: 300px; }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¸ å°ç£å…©æ£²é¡å…¨åœ–é‘‘</h1>
    <div class="subtitle">æ”¶éŒ„ 43 ç¨®è›™é¡ç”Ÿæ…‹èˆ‡é³´å«è²</div>
</header>

<div class="nav">
    <button class="nav-btn active" onclick="setTab('daily', this)">ğŸ”® æ¯æ—¥ä¸€è›™</button>
    <button class="nav-btn" onclick="setTab('guide', this)">ğŸ“– ç”Ÿæ…‹åœ–é‘‘</button>
    <button class="nav-btn" onclick="setTab('sound', this)">ğŸµ è½éŸ³è¾¨ä½</button>
    <button class="nav-btn" onclick="setTab('quiz', this)">ğŸŒ² è¦–è¦ºæœƒè€ƒ</button>
</div>

<div class="container">

    <div id="sec-daily" class="section active">
        <div class="daily-container">
            <h2 style="color:var(--primary); margin: 0 0 5px 0; font-size: 1.3rem;">ğŸ“… ä»Šå¤©çš„å…©æ£²æœ‹å‹</h2>
            <p style="color:#666; font-size:0.85rem; margin-top: 0;">æ¢ç´¢å°ç£æ¿•åœ°èˆ‡æ£®æ—çš„å¤œç²¾éˆ</p>
            
            <div class="card-scene">
                <div class="card-inner" id="daily-card-inner">
                    <div class="card-face card-front" onclick="flipDailyCard()">
                        <div style="font-size:4rem; margin-bottom:10px; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">ğŸ¸</div>
                        <h2 style="letter-spacing: 2px; font-size: 1.5rem;">DAILY FROG</h2>
                        <div class="daily-date" id="daily-date-display">...</div>
                        <p style="opacity: 0.9; font-size: 0.9rem;">é»æ“Šç¿»é–‹</p>
                    </div>
                    
                    <div class="card-face card-back">
                        <div class="daily-img-wrapper" onclick="openDailyZoom()">
                            <img id="daily-img" class="daily-img" src="" alt="Amphibian">
                            <div class="loader" id="daily-loader" style="position:absolute; top:45%; left:45%;"></div>
                            <div class="zoom-hint">ğŸ” é»åœ–æ”¾å¤§</div>
                        </div>
                        <div class="daily-info-box">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <h2 id="daily-name" style="margin:0; color:var(--primary); font-size: 1.4rem;">è¼‰å…¥ä¸­...</h2>
                                <span id="daily-status" class="status-badge"></span>
                            </div>
                            <p id="daily-eng" style="color:#78909c; font-style:italic; font-size:0.85rem; margin-top:2px;"></p>
                            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
                            <p id="daily-desc" style="line-height:1.6; color:#546e7a; font-size:0.9rem;">é€£ç·šä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="sec-guide" class="section">
        <div class="tools-bar">
            <input type="text" id="search-input" class="search-box" placeholder="æœå°‹ (å¦‚ï¼šè‡ºåŒ—æ¨¹è›™, èŸ¾èœ)..." onkeyup="renderGuide()">
            <div class="filter-scroll">
                <div class="filter-tag active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
                <div class="filter-tag" onclick="setFilter('æ¨¹è›™', this)">æ¨¹è›™ç§‘</div>
                <div class="filter-tag" onclick="setFilter('èµ¤è›™', this)">èµ¤è›™/å‰èˆŒè›™</div>
                <div class="filter-tag" onclick="setFilter('èŸ¾èœ', this)">èŸ¾èœç§‘</div>
                <div class="filter-tag" onclick="setFilter('æ¨¹èŸ¾', this)">æ¨¹èŸ¾ç§‘</div>
                <div class="filter-tag" onclick="setFilter('ç‹¹å£è›™', this)">ç‹¹å£è›™ç§‘</div>
                <div class="filter-tag" onclick="setFilter('å±±æ¤’é­š', this)">å±±æ¤’é­šç§‘</div>
                <div class="filter-tag" onclick="setFilter('ç‰¹æœ‰ç¨®', this)">ç‰¹æœ‰ç¨®</div>
                <div class="filter-tag" onclick="setFilter('ä¿è‚²', this)">ä¿è‚²é¡</div>
                <div class="filter-tag" onclick="setFilter('å¤–ä¾†ç¨®', this)">å¤–ä¾†ç¨®</div>
            </div>
            <div style="text-align:right; font-size:0.75rem; color:#888; margin-top:8px;">
                è³‡æ–™åº«ï¼š<span id="db-count">0</span> ç¨®
            </div>
        </div>
        <div id="guide-grid" class="plant-grid"></div>
    </div>

    <div id="sec-sound" class="section">
        <div id="sound-menu" class="quiz-panel">
            <h2 style="color:var(--primary); font-size: 1.4rem;">ğŸµ è½éŸ³è¾¨ä½å¤§æŒ‘æˆ°</h2>
            <p style="font-size: 0.95rem; color: #555;">é–‰ä¸Šçœ¼ç›ï¼Œè†è½å¤§è‡ªç„¶çš„äº¤éŸ¿æ¨‚</p>
            <br>
            <div style="font-size:3.5rem; margin-bottom:15px;">ğŸ‘‚</div>
            <button class="nav-btn" style="background:var(--accent); color:#37474f; width:100%; padding:15px; font-size:1.1rem;" onclick="startSoundQuiz()">
                é–‹å§‹è½åŠ›æ¸¬é©—
            </button>
        </div>

        <div id="sound-play" class="quiz-panel" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#78909c; font-size: 0.9rem;">
                <span id="s-progress">1 / 5</span>
                <span>åˆ†æ•¸: <span id="s-score">0</span></span>
            </div>
            
            <h3 style="margin:0; color:#37474f; font-size: 1.2rem;">é€™æ˜¯èª°çš„å«è²ï¼Ÿ</h3>

            <div class="q-media-box" style="border-style: solid; border-color: #a5d6a7;">
                <div class="sound-player-large" onclick="playQuizSound()">
                    <div class="sp-icon">â–¶ï¸</div>
                    <div class="sp-text">é»æ“Šæ’­æ”¾è²éŸ³</div>
                    <div id="wave-anim" class="playing-wave">
                        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
                    </div>
                </div>
            </div>

            <div id="s-opt-container"></div>
            <div id="s-feedback" style="height:25px; font-weight:bold; margin-top:5px; font-size: 1rem;"></div>

            <div id="s-reveal-card" class="reveal-box">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong id="s-rev-name" style="font-size:1.2rem; color:var(--primary);"></strong>
                    <span id="s-rev-status" class="status-badge"></span>
                </div>
                <div style="text-align:center; min-height:100px; display:flex; align-items:center; justify-content:center;">
                     <img id="s-rev-img" style="width:100%; max-height:200px; object-fit:contain; margin-top:10px; display:none; border-radius:8px;">
                     <div id="s-rev-loader" class="loader" style="display:none; margin: 20px auto;"></div>
                </div>
                <p id="s-rev-desc" style="font-size:0.9rem; margin-top:8px; color:#455a64; line-height:1.5;"></p>
            </div>

            <button id="s-next-btn" class="nav-btn" style="width:100%; background:var(--primary); color:white; margin-top:15px; display:none;" onclick="nextSoundQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
            <button onclick="quitSoundQuiz()" style="background:none; border:none; margin-top:15px; color:#90a4ae; text-decoration:underline; cursor:pointer; font-size: 0.9rem;">é€€å‡º</button>
        </div>

        <div id="sound-result" class="quiz-panel" style="display:none;">
            <h2>ğŸµ æ¸¬é©—çµæŸ</h2>
            <p>è½åŠ›å¾—åˆ†</p>
            <h1 id="s-final-score" style="font-size:3.5rem; margin:10px 0; color:var(--primary);">0</h1>
            <p id="s-final-comment" style="color:#666; font-size:0.9rem;"></p>
            <br>
            <button class="nav-btn" onclick="quitSoundQuiz()">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

    <div id="sec-quiz" class="section">
        <div id="quiz-menu" class="quiz-panel">
            <h2 style="color:var(--primary); font-size: 1.4rem;">ğŸ” è¦–è¦ºè¾¨è­˜æŒ‘æˆ°</h2>
            <p style="font-size: 0.95rem; color: #555;">å…¨å°ç‰©ç¨®å¤§æœæŸ¥ï¼Œçœ‹åœ–çŒœçŒœçœ‹</p>
            <br>
            <div style="font-size:3.5rem; margin-bottom:15px;">ğŸ§</div>
            <button class="nav-btn" style="background:var(--primary); color:white; width:100%; padding:15px; font-size:1.1rem;" onclick="startQuiz()">
                é–‹å§‹è¦–è¦ºæ¸¬é©—
            </button>
        </div>

        <div id="quiz-play" class="quiz-panel" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; color:#78909c; font-size: 0.9rem;">
                <span id="q-progress">1 / 10</span>
                <span>åˆ†æ•¸: <span id="q-score">0</span></span>
            </div>
            
            <h3 style="margin:0; color:#37474f; font-size: 1.2rem;">é€™æ˜¯å“ªä¸€ç¨®å…©æ£²é¡ï¼Ÿ</h3>
            <div id="skip-indicator" class="skip-msg" style="display:none; color:red; font-size:0.8rem;">âš ï¸ åœ–ç‰‡è®€å–å¤±æ•—ï¼Œè‡ªå‹•è£œé¡Œ</div>

            <div class="q-media-box">
                <div class="loader" id="v-loader"></div>
                <img id="q-img" class="full-img">
            </div>

            <div id="opt-container"></div>
            <div id="feedback" style="height:25px; font-weight:bold; margin-top:5px; font-size: 1rem;"></div>

            <div id="reveal-card" class="reveal-box">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong id="rev-name" style="font-size:1.2rem; color:var(--primary);"></strong>
                    <span id="rev-status" class="status-badge"></span>
                </div>
                <p id="rev-desc" style="font-size:0.9rem; margin-top:8px; color:#455a64; line-height:1.5;"></p>
                <a id="rev-link" href="#" target="_blank" style="font-size:0.85rem; display:block; margin-top:10px; color:var(--secondary); font-weight:bold;">ğŸ“– æŸ¥çœ‹ç™¾ç§‘</a>
            </div>

            <button id="next-btn" class="nav-btn" style="width:100%; background:var(--primary); color:white; margin-top:15px; display:none;" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
            <button onclick="quitQuiz()" style="background:none; border:none; margin-top:15px; color:#90a4ae; text-decoration:underline; cursor:pointer; font-size: 0.9rem;">é€€å‡º</button>
        </div>

        <div id="quiz-result" class="quiz-panel" style="display:none;">
            <h2>ğŸ† æŒ‘æˆ°å®Œæˆ</h2>
            <p>æœ¬æ¬¡å¾—åˆ†</p>
            <h1 id="final-score" style="font-size:3.5rem; margin:10px 0; color:var(--primary);">0</h1>
            <div id="final-rank" style="font-size:1rem; background:var(--accent); color:#37474f; padding:6px 20px; border-radius:20px; display:inline-block; font-weight:bold;"></div>
            <br><br>
            <button class="nav-btn" onclick="quitQuiz()">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

</div>

<div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-box">
        <div class="img-area">
            <div class="loader" id="m-loader"></div>
            <img id="m-img" class="full-img">
            <div id="m-err" style="display:none; color:white;">ç„¡åœ–ç‰‡è³‡æ–™</div>
        </div>
        <div class="info-area">
            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                <h2 id="m-name" style="margin:0; color:var(--primary); font-size: 1.5rem;"></h2>
                <span id="m-status" class="status-badge" style="margin:0;"></span>
            </div>
            <div id="m-latin" style="color:#78909c; font-style:italic; margin-bottom:10px; margin-top:2px; font-size: 0.9rem;"></div>
            
            <button id="m-play-btn" class="audio-btn" onclick="playModalSound()">
                <span>ğŸ”Š æ’­æ”¾é³´å«è²</span>
            </button>
            <audio id="modal-audio" style="display:none;"></audio>

            <p id="m-desc" style="line-height:1.6; color:#455a64; font-size: 0.95rem;">è®€å–ä¸­...</p>
            
            <a id="m-wiki" href="#" target="_blank" style="display:block; text-align:center; margin-top:20px; padding:12px; background:#e0f2f1; color:var(--primary); text-decoration:none; border-radius:8px; font-weight:bold;">å‰å¾€ç¶­åŸºç™¾ç§‘é–±è®€æ›´å¤š</a>
        </div>
        <button onclick="closeModal(null)" style="width:100%; padding:15px; border:none; background:#eceff1; color:#78909c; cursor:pointer; font-size:1rem; border-top:1px solid #ddd; font-weight: bold;">é—œé–‰è¦–çª—</button>
    </div>
</div>

<script src="frogs.js"></script>

<script>
    // --- Global Helpers ---
    function getStatusClass(status) {
        if (status.includes("å¤–ä¾†ç¨®")) return "st-invasive";
        if (status.includes("ç‰¹æœ‰ç¨®")) return "st-endemic";
        if (status.includes("ä¿è‚²")) return "st-conservation";
        if (status.includes("å±±æ¤’é­š")) return "st-salamander";
        return "st-common";
    }

    const getWikiData = async (plantName, wikiTerm = null) => {
        try {
            const term = wikiTerm || plantName;
            const res = await fetch(`https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(term)}`);
            if(!res.ok) throw new Error();
            return await res.json();
        } catch(e) { return null; }
    };

    let currentSound = null; // To manage playing audio

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        if(typeof amphibians === 'undefined') {
            alert("éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° frogs.js è³‡æ–™åº«æª”æ¡ˆã€‚è«‹ç¢ºä¿å…©å€‹æª”æ¡ˆåœ¨åŒä¸€ç›®éŒ„ã€‚");
            return;
        }
        renderGuide();
        document.getElementById('db-count').innerText = amphibians.length;
        
        // Daily Date
        const today = new Date();
        const dateStr = `${today.getFullYear()} / ${today.getMonth()+1} / ${today.getDate()}`;
        document.getElementById('daily-date-display').innerText = dateStr;
    });

    // --- Tab Switching ---
    function setTab(tab, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`sec-${tab}`).classList.add('active');
        btn.classList.add('active');
        window.scrollTo(0, 0);

        // Stop any audio when switching tabs
        if(currentSound) { currentSound.pause(); currentSound = null; }
        if(soundState.audio) { soundState.audio.pause(); soundState.audio = null; }

        if (tab !== 'quiz') quitQuiz();
        if (tab !== 'sound') quitSoundQuiz();
    }

    // --- Guide Logic ---
    let currentFilter = 'all';
    function renderGuide() {
        if(typeof amphibians === 'undefined') return;
        
        const grid = document.getElementById('guide-grid');
        grid.innerHTML = '';
        const term = document.getElementById('search-input').value.toLowerCase();
        
        const list = amphibians.filter(p => {
            let matchCat = false;
            if(currentFilter === 'all') matchCat = true;
            else if(currentFilter === 'èµ¤è›™') matchCat = p.cat === 'èµ¤è›™' || p.cat === 'å‰èˆŒè›™';
            else if(currentFilter === 'ä¿è‚²') matchCat = p.status.includes('ä¿è‚²');
            else if(currentFilter === 'ç‰¹æœ‰ç¨®') matchCat = p.status.includes('ç‰¹æœ‰ç¨®');
            else if(currentFilter === 'å¤–ä¾†ç¨®') matchCat = p.status.includes('å¤–ä¾†ç¨®') || p.cat === 'å¤–ä¾†ç¨®';
            else matchCat = p.cat.includes(currentFilter);
            
            const matchSearch = p.name.includes(term) || p.eng.toLowerCase().includes(term);
            return matchCat && matchSearch;
        });

        list.forEach(p => {
            const el = document.createElement('div');
            el.className = 'plant-card';
            // Add sound icon if sound exists
            const soundIcon = p.sound ? `<span class="has-sound-icon">ğŸµ</span>` : '';
            
            el.innerHTML = `
                ${soundIcon}
                <div class="p-name">${p.name}</div>
                <div class="p-cat">${p.eng.split(' ')[0]}...</div>
                <div class="status-badge ${getStatusClass(p.status)}">${p.status}</div>
            `;
            el.onclick = () => openModal(p);
            grid.appendChild(el);
        });
    }

    function setFilter(cat, btn) {
        currentFilter = cat;
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        renderGuide();
    }

    // --- Daily Card Logic ---
    let isDailyFlipped = false;
    let currentDailyPlant = null;

    function flipDailyCard() {
        if (isDailyFlipped) return;
        const cardInner = document.getElementById('daily-card-inner');
        cardInner.classList.add('is-flipped');
        isDailyFlipped = true;
        loadDailyPlantData();
    }
    
    function openDailyZoom() {
        if (!currentDailyPlant) return;
        openModal(currentDailyPlant);
    }

    async function loadDailyPlantData() {
        const todayStr = new Date().toDateString();
        let hash = 0;
        for (let i = 0; i < todayStr.length; i++) hash = todayStr.charCodeAt(i) + ((hash << 5) - hash);
        const seed = Math.abs(hash); 
        const index = seed % amphibians.length;
        const plant = amphibians[index];
        currentDailyPlant = plant;

        document.getElementById('daily-name').innerText = plant.name;
        document.getElementById('daily-eng').innerText = plant.eng;
        
        const badge = document.getElementById('daily-status');
        badge.innerText = plant.status;
        badge.className = `status-badge ${getStatusClass(plant.status)}`;

        const data = await getWikiData(plant.name, plant.wikiTerm);
        const img = document.getElementById('daily-img');
        const loader = document.getElementById('daily-loader');
        const desc = document.getElementById('daily-desc');

        if(data) {
            desc.innerText = data.extract ? (data.extract.substring(0, 100) + "...") : "æš«ç„¡è©³ç´°ä»‹ç´¹ã€‚";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display = 'none'; };
            } else {
                loader.style.display = 'none';
                img.alt = "No Image";
            }
        } else {
            loader.style.display = 'none';
            desc.innerText = "è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚";
        }
    }

    // --- Modal & Sound Player ---
    let modalAudioObj = null;

    async function openModal(plant) {
        const modal = document.getElementById('modal');
        const img = document.getElementById('m-img');
        const loader = document.getElementById('m-loader');
        
        modal.style.display = 'flex';
        img.style.display = 'none';
        loader.style.display = 'block';
        document.getElementById('m-err').style.display = 'none';
        document.getElementById('m-name').innerText = plant.name;
        document.getElementById('m-latin').innerText = plant.eng;
        document.getElementById('m-desc').innerText = "é€£ç·šç™¾ç§‘ä¸­...";
        document.getElementById('m-wiki').href = `https://zh.wikipedia.org/wiki/${plant.wikiTerm || plant.name}`;
        
        const badge = document.getElementById('m-status');
        badge.innerText = plant.status;
        badge.className = `status-badge ${getStatusClass(plant.status)}`;

        // Setup Audio Button
        const audioBtn = document.getElementById('m-play-btn');
        if (plant.sound) {
            audioBtn.classList.remove('disabled');
            audioBtn.innerHTML = "<span>ğŸ”Š æ’­æ”¾é³´å«è²</span>";
            audioBtn.onclick = () => playModalSound(plant.sound);
        } else {
            audioBtn.classList.add('disabled');
            audioBtn.innerHTML = "<span>ğŸ”‡ æš«ç„¡è²éŸ³è³‡æ–™</span>";
            audioBtn.onclick = null;
        }

        const data = await getWikiData(plant.name, plant.wikiTerm);
        if(data) {
            document.getElementById('m-desc').innerText = data.extract || "ç„¡è©³ç´°æ‘˜è¦";
            const src = data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null);
            if(src) {
                img.src = src;
                img.onload = () => { loader.style.display='none'; img.style.display='block'; };
            } else {
                loader.style.display='none';
                document.getElementById('m-err').style.display='block';
            }
        } else {
            loader.style.display='none';
            document.getElementById('m-desc').innerText = "è³‡æ–™è®€å–å¤±æ•—ã€‚";
        }
    }

    function playModalSound(url) {
        if(modalAudioObj) {
            modalAudioObj.pause();
            modalAudioObj = null;
            document.getElementById('m-play-btn').innerHTML = "<span>ğŸ”Š æ’­æ”¾é³´å«è²</span>";
            return;
        }
        
        modalAudioObj = new Audio(url);
        modalAudioObj.onerror = function() {
            alert(`æ’­æ”¾å¤±æ•—ï¼\næ‰¾ä¸åˆ°æª”æ¡ˆï¼š${url}\nè«‹ç¢ºèªå·²ä¸‹è¼‰è©² MP3 ä¸¦æ”¾å…¥ sounds è³‡æ–™å¤¾ã€‚`);
            document.getElementById('m-play-btn').innerHTML = "<span>ğŸ”Š æ’­æ”¾é³´å«è²</span>";
            modalAudioObj = null;
        };

        modalAudioObj.play().catch(e => console.error(e));
        document.getElementById('m-play-btn').innerHTML = "<span>â¹ï¸ åœæ­¢æ’­æ”¾</span>";
        
        modalAudioObj.onended = () => {
            modalAudioObj = null;
            document.getElementById('m-play-btn').innerHTML = "<span>ğŸ”Š æ’­æ”¾é³´å«è²</span>";
        };
    }

    function closeModal(e) {
        if(!e || e.target.id === 'modal') {
            document.getElementById('modal').style.display = 'none';
            if(modalAudioObj) {
                modalAudioObj.pause();
                modalAudioObj = null;
            }
        }
    }

    // --- Sound Quiz Logic (NEW) ---
    let soundState = { pool: [], queue: [], idx: 0, score: 0, answering: false, audio: null };

    function startSoundQuiz() {
        // Filter frogs that actually have sound defined (not null)
        let pool = amphibians.filter(a => a.sound !== null).sort(() => Math.random() - 0.5);
        
        if (pool.length < 4) {
            alert("ç›®å‰è³‡æ–™åº«ä¸­è¨­å®šæœ‰è²éŸ³çš„è›™é¡ä¸è¶³ä»¥é€²è¡Œæ¸¬é©— (éœ€è‡³å°‘4ç¨®)ã€‚");
            return;
        }

        soundState = { pool: pool, queue: pool.slice(0, 5), idx: 0, score: 0, answering: false, audio: null };
        document.getElementById('sound-menu').style.display = 'none';
        document.getElementById('sound-result').style.display = 'none';
        document.getElementById('sound-play').style.display = 'block';
        document.getElementById('s-score').innerText = 0;
        loadSoundQuestion();
    }

    function loadSoundQuestion() {
        if(soundState.idx >= 5) { finishSoundQuiz(); return; }

        const plant = soundState.queue[soundState.idx];
        soundState.answering = true;
        
        // Setup Audio
        soundState.audio = new Audio(plant.sound);
        soundState.audio.onerror = function() {
            alert(`é¡Œç›®è¼‰å…¥å¤±æ•—ï¼šæ‰¾ä¸åˆ° ${plant.name} çš„è²éŸ³æª” (${plant.sound})`);
        };

        document.getElementById('s-progress').innerText = `${soundState.idx+1} / 5`;
        document.getElementById('s-reveal-card').style.display = 'none';
        
        // Hide image initially
        document.getElementById('s-rev-img').style.display = 'none';
        document.getElementById('s-rev-img').src = '';
        
        document.getElementById('s-next-btn').style.display = 'none';
        document.getElementById('s-feedback').innerText = '';
        
        // Reset player UI
        const spText = document.querySelector('.sp-text');
        const spIcon = document.querySelector('.sp-icon');
        spText.innerText = "é»æ“Šæ’­æ”¾è²éŸ³";
        spIcon.innerText = "â–¶ï¸";
        document.getElementById('wave-anim').classList.remove('active');

        // Options
        let opts = [plant];
        let wrongPool = amphibians.filter(p => p.name !== plant.name);
        for(let i=0; i<3; i++) opts.push(wrongPool.splice(Math.floor(Math.random() * wrongPool.length), 1)[0]);
        opts.sort(() => Math.random() - 0.5);

        document.getElementById('s-opt-container').innerHTML = opts.map(p => 
            `<button class="opt-btn" onclick="checkSoundAnswer(this, '${p.name}')">${p.name}</button>`
        ).join('');
    }

    function playQuizSound() {
        if(!soundState.audio) return;
        
        const spText = document.querySelector('.sp-text');
        const spIcon = document.querySelector('.sp-icon');
        
        if(soundState.audio.paused) {
            soundState.audio.play();
            spText.innerText = "æ’­æ”¾ä¸­...";
            spIcon.innerText = "ğŸ”Š";
            document.getElementById('wave-anim').classList.add('active');
            soundState.audio.onended = () => {
                spText.innerText = "å†æ¬¡æ’­æ”¾";
                spIcon.innerText = "â–¶ï¸";
                document.getElementById('wave-anim').classList.remove('active');
            };
        } else {
            soundState.audio.pause();
            soundState.audio.currentTime = 0;
            spText.innerText = "é»æ“Šæ’­æ”¾è²éŸ³";
            spIcon.innerText = "â–¶ï¸";
            document.getElementById('wave-anim').classList.remove('active');
        }
    }

    function checkSoundAnswer(btn, name) {
        if(!soundState.answering) return;
        soundState.answering = false;

        // Stop audio
        if(soundState.audio) {
            soundState.audio.pause();
            document.getElementById('wave-anim').classList.remove('active');
        }
        
        const correct = soundState.queue[soundState.idx];
        const isRight = name === correct.name;

        if(isRight) {
            btn.classList.add('correct');
            document.getElementById('s-feedback').innerText = "â­• ç­”å°äº†ï¼è€³æœµçœŸéˆï¼";
            document.getElementById('s-feedback').style.color = "green";
            soundState.score += 20;
        } else {
            btn.classList.add('wrong');
            document.getElementById('s-feedback').innerText = `âŒ ç­”æ¡ˆæ˜¯ï¼š${correct.name}`;
            document.getElementById('s-feedback').style.color = "red";
            document.querySelectorAll('#s-opt-container .opt-btn').forEach(b => {
                if(b.innerText === correct.name) b.classList.add('correct');
            });
        }
        document.getElementById('s-score').innerText = soundState.score;
        document.getElementById('s-next-btn').style.display = 'block';

        // Reveal Information and Image
        const rev = document.getElementById('s-reveal-card');
        rev.style.display = 'block';
        document.getElementById('s-rev-name').innerText = correct.name;
        document.getElementById('s-rev-status').innerText = correct.status;
        document.getElementById('s-rev-status').className = `status-badge ${getStatusClass(correct.status)}`;
        
        // Load Image dynamically
        const img = document.getElementById('s-rev-img');
        const loader = document.getElementById('s-rev-loader');
        img.style.display = 'none';
        loader.style.display = 'block';

        getWikiData(correct.name, correct.wikiTerm).then(d => {
            document.getElementById('s-rev-desc').innerText = d ? (d.extract.substring(0, 80) + "...") : "ç„¡è³‡æ–™";
            const src = d && (d.originalimage ? d.originalimage.source : (d.thumbnail ? d.thumbnail.source : null));
            
            loader.style.display = 'none';
            if(src) { 
                img.src = src; 
                img.style.display = 'block'; 
            } else {
                img.style.display = 'none';
            }
        });
    }

    function nextSoundQuestion() {
        soundState.idx++;
        loadSoundQuestion();
    }

    function finishSoundQuiz() {
        document.getElementById('sound-play').style.display = 'none';
        document.getElementById('sound-result').style.display = 'block';
        document.getElementById('s-final-score').innerText = soundState.score;
        
        let msg = "";
        if(soundState.score === 100) msg = "ğŸ¶ æ ¹æœ¬æ˜¯è²ç´ç­‰ç´šçš„è€³æœµï¼";
        else if(soundState.score >= 60) msg = "ğŸ‘‚ å¾ˆä¸éŒ¯ï¼Œå°å¤§è‡ªç„¶å¾ˆæœ‰æ„Ÿè¦ºå–”ï¼";
        else msg = "ğŸ™‰ å¯èƒ½è¦æŒ–ä¸€ä¸‹è€³æœµå†è©¦è©¦çœ‹ï¼Ÿ";
        document.getElementById('s-final-comment').innerText = msg;
    }

    function quitSoundQuiz() {
        if(soundState.audio) soundState.audio.pause();
        document.getElementById('sound-play').style.display = 'none';
        document.getElementById('sound-result').style.display = 'none';
        document.getElementById('sound-menu').style.display = 'block';
    }


    // --- Visual Quiz Logic (Legacy) ---
    let gameState = { pool: [], queue: [], idx: 0, score: 0, answering: false };
    let retryCount = 0;

    function startQuiz() {
        let pool = [...amphibians].sort(() => Math.random() - 0.5);
        gameState = { pool: pool, queue: pool.slice(0, 10), idx: 0, score: 0, answering: false };
        retryCount = 0;
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-play').style.display = 'block';
        document.getElementById('q-score').innerText = 0;
        loadQuestion();
    }

    async function loadQuestion() {
        if(gameState.idx >= 10) { finishQuiz(); return; }
        
        const plant = gameState.queue[gameState.idx];
        gameState.answering = true;

        document.getElementById('q-progress').innerText = `${gameState.idx+1} / 10`;
        document.getElementById('reveal-card').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback').innerText = '';
        document.getElementById('skip-indicator').style.display = 'none';
        document.getElementById('q-img').style.display = 'none';
        document.getElementById('v-loader').style.display = 'block';

        const data = await getWikiData(plant.name, plant.wikiTerm);
        const src = data && (data.originalimage ? data.originalimage.source : (data.thumbnail ? data.thumbnail.source : null));
        if(!src) {
            handleSkip();
            return;
        }

        const img = document.getElementById('q-img');
        img.src = src;
        img.onload = () => {
            document.getElementById('v-loader').style.display = 'none';
            img.style.display = 'block';
            retryCount = 0;
        };
        img.onerror = () => { handleSkip(); }

        let opts = [plant];
        let pool = amphibians.filter(p => p.name !== plant.name);
        for(let i=0; i<3; i++) opts.push(pool.splice(Math.floor(Math.random() * pool.length), 1)[0]);
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('opt-container').innerHTML = opts.map(p => 
            `<button class="opt-btn" onclick="checkAnswer(this, '${p.name}')">${p.name}</button>`
        ).join('');
    }

    function handleSkip() {
        retryCount++;
        if(retryCount > 10) {
            alert("ç¶²è·¯ç‹€æ³ä¸ä½³ï¼Œåœ–ç‰‡è®€å–å›°é›£");
            quitQuiz();
            return;
        }
        let replacementIndex = 10 + retryCount;
        if(replacementIndex < gameState.pool.length) {
            gameState.queue[gameState.idx] = gameState.pool[replacementIndex];
            document.getElementById('skip-indicator').style.display = 'block';
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function checkAnswer(btn, name) {
        if(!gameState.answering) return;
        gameState.answering = false;
        
        const correct = gameState.queue[gameState.idx];
        const isRight = name === correct.name;
        if(isRight) {
            btn.classList.add('correct');
            document.getElementById('feedback').innerText = "â­• ç­”å°äº†ï¼";
            document.getElementById('feedback').style.color = "green";
            gameState.score += 10;
        } else {
            btn.classList.add('wrong');
            document.getElementById('feedback').innerText = `âŒ æ˜¯ï¼š${correct.name}`;
            document.getElementById('feedback').style.color = "red";
            document.querySelectorAll('.opt-btn').forEach(b => {
                if(b.innerText === correct.name) b.classList.add('correct');
            });
        }
        document.getElementById('q-score').innerText = gameState.score;
        document.getElementById('next-btn').style.display = 'block';

        const rev = document.getElementById('reveal-card');
        rev.style.display = 'block';
        document.getElementById('rev-name').innerText = correct.name;
        document.getElementById('rev-link').href = `https://zh.wikipedia.org/wiki/${correct.wikiTerm || correct.name}`;
        
        const badge = document.getElementById('rev-status');
        badge.innerText = correct.status;
        badge.className = `status-badge ${getStatusClass(correct.status)}`;

        getWikiData(correct.name, correct.wikiTerm).then(d => document.getElementById('rev-desc').innerText = d ? d.extract : "ç„¡è³‡æ–™");
    }

    function nextQuestion() {
        gameState.idx++;
        loadQuestion();
    }

    function finishQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'block';
        document.getElementById('final-score').innerText = gameState.score;
        
        let rank = "";
        if(gameState.score === 100) rank = "ğŸ‘‘ å…©æ£²é¡éœ¸ä¸»";
        else if(gameState.score >= 80) rank = "ğŸ¸ é’è›™é”äºº";
        else if(gameState.score >= 60) rank = "ğŸ” æ¿•åœ°è§€å¯Ÿå®¶";
        else rank = "ğŸ¥š èŒèšªç´šæ–°æ‰‹";
        document.getElementById('final-rank').innerText = rank;
    }

    function quitQuiz() {
        document.getElementById('quiz-play').style.display = 'none';
        document.getElementById('quiz-result').style.display = 'none';
        document.getElementById('quiz-menu').style.display = 'block';
    }
</script>

</body>
</html>
